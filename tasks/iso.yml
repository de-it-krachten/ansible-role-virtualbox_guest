---

- name: Delete directory /tmp/VBoxGuestAdditions
  file:
    path: /tmp/VBoxGuestAdditions
    state: absent

- name: Create directory /tmp/VBoxGuestAdditions
  file:
    path: /tmp/VBoxGuestAdditions
    state: directory
    mode: '0755'

- name: Copy the guest additions ISO
  copy:
    src: "{{ virtbox_iso }}"
    dest: /tmp/VBoxGuestAdditions.iso
    mode: "0644"

- name: Extra ISO
  command: 7z x -o/tmp/VBoxGuestAdditions /tmp/VBoxGuestAdditions.iso
  check_mode: false
  changed_when: false

- name: Change permissions
  file:
    path: /tmp/VBoxGuestAdditions
    mode: '0755'
    recurse: true

- name: Set installer location
  set_fact:
    installer: /tmp/VBoxGuestAdditions/VBoxLinuxAdditions.run
